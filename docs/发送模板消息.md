# 模板消息推送说明
用户在微信商城的发生的一系列操作，需要以模板消息的形式通知用户。用户在已关注服务号的前提下，能成功收到模板消息，否则不能收到。

> ### 接口调用说明

接口地址：
`http://wxadmin.teshehui.com/wxapi/templatemsg/send`
以http get形式调用，有4个公共参数

- `openid` 用户的openid
- `url` 用户点击模板消息打开的URL地址
- `timestamp` 签名用到的时间戳，取当前时间的数字形式，单位是秒
- `signature` 签名指纹，验证合法性

其他参数根据接口不同而变化，具体见下面的接口列表说明。

签名规则见附录 1

> ### 接口列表

1. 订单支付成功
    参数列表：
    - `type` 值为 `order_pay_success`
    - `title` 标题描述
    - `money` 商品金额
    - `product` 商品名称
    - `remark` 备注信息
    效果如下：
        ```
        我们已收到您的货款，开始为您打包商品，请耐心等待: )
        支付金额：30.00元
        商品信息：我是商品名字

        如有问题请致电400-828-1878或直接在微信留言，小易将第一时间为您服务！
        ```

2. 订单未支付
    参数列表：
    - `type` 值为 `order_nopay_remind`
    - `title` 标题描述
    - `order_time` 下单时间
    - `order_id` 订单号
    - `remark` 备注信息
    效果如下：
        ```
        客官，您好！您的订单未支付，即将关闭。

        下单时间：2013年11月11日14：41
        订单号：【143814438】
        还未付款，未付款订单24时内关闭，请及时付款。感谢您对1号店的青睐！点击查看详情。
        ```

2. 订单发货
    参数列表：
    - `type` 值为 `order_shipped`
    - `title` 标题描述
    - `order_id` 订单号
    - `ship_company` 物流公司
    - `ship_num` 物流单号
    - `remark` 备注信息
    示例：
        ```
        亲，宝贝已经启程了，好想快点来到你身边
        订单编号:201408189987
        物流公司:圆通快递
        物流单号:6522238281
        点击查看完整的物流信息 。如有问题请致电XXX或直接在微信里留言，XXX将在第一时间为您服务！
        ```

> ### 附录

1. 签名规则
    - 将所有参数按照参数名做升序排列（注：`signature`参数不参加签名计算）
    比如参数是：`type`=order_pay_success&`openid`=p1&`url`=p2&`timestamp`=p3&`title`=p4&`money`=p5&`product`=p6&`remark`=p7
    根据参数名做了升序排列后顺序如下：
    money：p5
    openid：p1
    product：p6
    remark：p7
    timestamp：p3
    title：p4
    type：order_pay_success
    url：p2
    - 对每个参数的名称和值分别取16进制的字符串形式（UTF-8编码，且大写），用=号连接起来。用&符号把所有这样的参数值形式连接起来，如下
    `6D6F6E6579=7035&6F70656E6964=7031&70726F64756374=7036&72656D61726B=7037&74696D6
     57374616D70=7033&7469746C65=7034&74797065=6F726465725F7061795F73756363657373&757
     26C=7032`
    - 将 token 和 上面得到的字符串用 & 链接。比如token是 123456，那得到的字符串如下：
    `123456&6D6F6E6579=7035&6F70656E6964=7031&70726F64756374=7036&72656D61726B=7037&74696D6
                57374616D70=7033&7469746C65=7034&74797065=6F726465725F7061795F73756363657373&757
                26C=7032`
    - 将上面得到的字符串求MD5值（大写），此值即为参数 signature 的值

    所以最终的请求url为：
    http://wxadmin.teshehui.com/wxapi/templatemsg/send?**type**=order_pay_success&**openid**=p1&**url**=p2&**timestamp**=p3&**title**=p4&**money**=p5&**product**=p6&**remark**=p7&**signature**=2957FBF5455ECB93F1D076D7712DE9C0

